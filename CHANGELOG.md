# 更新日誌

## 🎨 v1.2 - 命盤視覺化 (2025-11-29)

### ✨ 新增功能

#### 八字命盤視覺化元件
- **專業命盤展示** (`BaziChart.vue`)
  - 四柱卡片佈局（年、月、日、時）
  - 天干地支雙層顯示，五行顏色編碼
  - 日主星號標記與高亮效果
  - 納音五行展示

- **地支藏干可視化**
  - 每個地支下方顯示藏干
  - 藏干五行顏色標註
  - 權重資訊展示

- **五行分布圖表**
  - 橫條圖視覺化五行強弱
  - 百分比與數值雙重顯示
  - 強弱等級標籤（極強、強、中、弱、極弱）

- **日主深度分析**
  - 獨立日主分析卡片
  - 日干五行詳細資訊
  - 五行數量統計

- **用神喜忌卡片**
  - 三欄式佈局（用神、喜神、忌神）
  - 顏色區分（綠、藍、紅）
  - 懸停動畫效果

### 🎨 UI/UX 改進

1. **卡片互動設計**
   - 懸停時卡片上浮效果
   - 陰影深度變化動畫
   - 日柱特殊邊框高亮

2. **五行顏色系統**
   - 金：灰色 (#9ca3af)
   - 木：綠色 (#22c55e)
   - 水：藍色 (#3b82f6)
   - 火：紅色 (#ef4444)
   - 土：黃色 (#f59e0b)

3. **響應式佈局**
   - 最大寬度 1200px
   - 網格自適應
   - 移動端友好

### 🔧 技術改進

- 移除 Tailwind `@apply` 指令，改用原生 CSS
- 相容 Tailwind CSS v4 新語法
- 元件化設計，便於重用
- Props 驅動數據展示

---

## 🎉 v1.1 - 專業功能增強 (2025-11-29)

### ✨ 新增功能

#### 1. 性別選擇
- 新增男性/女性單選按鈕
- 儲存性別資訊供後續大運計算使用
- UI: 簡潔的單選框設計

#### 2. 精確時間輸入
- **精確到分鐘**：新增分鐘輸入框 (0-59)
- **12 時辰快速選擇**：一鍵設置時辰起始時間
  - 子時 (23:00), 丑時 (01:00), 寅時 (03:00), 卯時 (05:00)
  - 辰時 (07:00), 巳時 (09:00), 午時 (11:00), 未時 (13:00)
  - 申時 (15:00), 酉時 (17:00), 戌時 (19:00), 亥時 (21:00)
- 當前時辰即時顯示與高亮

#### 3. 出生地點選擇
- **25 個城市快速選擇**
  - 中國大陸：北京、上海、廣州、深圳、成都、重慶等 20 個主要城市
  - 港澳台：台北、台中、高雄、香港、澳門
- **自訂經緯度功能**
  - 可開關切換
  - 精確到小數點後 4 位
  - 即時驗證與顯示

#### 4. 真太陽時修正 ⭐ 核心功能
- **經度時差修正**
  - 公式：`(當地經度 - 時區標準經度) × 4 分鐘`
  - 自動計算不同城市的時差
  - 範例：烏魯木齊 (87.6°E) 與北京時差約 130 分鐘

- **均時差修正**
  - 使用傅立葉級數近似公式
  - 考慮地球橢圓軌道影響
  - 範圍：-16 到 +14 分鐘

- **完整修正流程**
  ```
  鐘錶時間 + 經度時差 + 均時差 = 真太陽時
  ```

- **UI 展示**
  - 修正開關（預設開啟）
  - 詳細說明文字
  - 即時顯示修正過程
  - 跨日提示

### 📁 新增文件

#### `src/utils/solarTime.js` (400+ 行)
完整的真太陽時計算工具庫

**核心函數**：
- `calculateLongitudeDiff()` - 經度時差計算
- `calculateEquationOfTime()` - 均時差計算
- `convertToSolarTime()` - 完整時間轉換
- `getShichenByTime()` - 時辰判定

**數據定義**：
- `CHINA_CITIES` - 25 城市經緯度
- `SHICHEN_RANGES` - 12 時辰詳細區間
- `TIMEZONE_STANDARD_LONGITUDE` - 時區標準經度

### 🎨 UI 改進

1. **新增命主資料卡片**
   - 性別、出生地、國曆、時辰
   - 真太陽時修正資訊

2. **優化輸入區塊**
   - 更清晰的表單佈局
   - 即時反饋與驗證
   - 響應式設計優化

3. **改進結果展示**
   - 更詳細的修正說明
   - 五行強弱中文顯示
   - 日主標註 ★

### 🔧 技術改進

- 使用 Vue 3 Computed Properties 優化性能
- 真太陽時即時計算
- 跨日邊界處理
- 表單驗證增強

---

## 📦 v1.0 - 核心功能 (2025-11-29)

### ✨ 初始功能

#### 核心計算
- 天干地支計算（年月日時四柱）
- 五虎遁月柱計算
- 五鼠遁時柱計算
- 萬年曆日柱計算
- 納音五行
- 五行分析（天干+地支+藏干）
- 五行強弱評級
- 用神喜忌推算

#### UI 界面
- Vue 3 + Vite + Tailwind CSS
- 響應式設計
- 五行顏色視覺化
- 即時計算反饋

#### 專案架構
- 模組化代碼結構
- 完整的工具函數庫
- 詳細的常數定義
- 測試文件

---

## 🎯 重要特性說明

### 真太陽時的重要性

#### 為什麼需要修正？

1. **經度跨度大**
   - 中國橫跨 5 個時區（約 60° 經度）
   - 全國使用統一的北京時間（東八區，120°E）
   - 東西部實際太陽時差異可達 2 小時以上

2. **地球軌道影響**
   - 地球繞日軌道是橢圓形
   - 地軸傾斜 23.5°
   - 導致真太陽時與平太陽時存在週期性差異

3. **時辰判定影響**
   - 時柱以 2 小時為一個時辰
   - 修正量接近 1 小時時，可能改變時辰
   - 直接影響八字準確性

#### 實際案例

**烏魯木齊出生 vs 台北出生（同樣鐘錶時間 14:30）**

| 項目 | 烏魯木齊 | 台北 |
|------|---------|------|
| 經度 | 87.6°E | 121.5°E |
| 經度時差 | -130 分鐘 | +6 分鐘 |
| 均時差 | +8 分鐘 | +8 分鐘 |
| **真太陽時** | **12:18** | **14:44** |
| **時辰** | **午時** | **未時** |

可以看到，即使鐘錶時間相同，真太陽時相差超過 2.5 小時！

---

## 🔬 技術細節

### 均時差公式

```javascript
// 年內第幾天
dayOfYear = Math.floor((date - startOfYear) / 86400000) + 1

// 角度參數
B = (2 × π × (dayOfYear - 81)) / 365

// 均時差（分鐘）
E = 9.87 × sin(2B) - 7.53 × cos(B) - 1.5 × sin(B)
```

這是基於傅立葉級數的簡化公式，精度約 ±1 分鐘。

### 經度時差原理

地球自轉：
- 360° / 24 小時 = 15° / 小時
- 1° = 4 分鐘

公式：
```
時差（分鐘）= (當地經度 - 標準經度) × 4
```

---

## 📊 測試結果

### 多城市測試（2025-01-15 14:30）

| 城市 | 經度 | 經度時差 | 均時差 | 真太陽時 | 時辰變化 |
|------|------|---------|--------|----------|---------|
| 北京 | 116.4°E | -14 min | +8 min | 14:24 | 無 |
| 上海 | 121.5°E | +6 min | +8 min | 14:44 | 無 |
| 成都 | 104.1°E | -64 min | +8 min | 13:34 | 無 |
| 烏魯木齊 | 87.6°E | -130 min | +8 min | 12:18 | **午時** ⚠️ |
| 台北 | 121.6°E | +6 min | +8 min | 14:44 | 無 |

---

## 🐛 已知問題

1. **Node.js 版本警告**
   - 影響：僅警告，不影響功能
   - 建議：升級到 Node 20.19+ 或 22.12+

2. **農曆轉換**
   - 狀態：簡化版本
   - 計畫：整合 lunar-javascript 專業庫

---

## 📝 下一步計畫

### Phase 2: 命理深化
- [ ] 十神計算
- [ ] 格局判斷
- [ ] 大運排盤
- [ ] 流年運勢
- [ ] 神煞配置

### Phase 3: 紫微斗數
- [ ] 命盤排列
- [ ] 14 主星安星
- [ ] 四化飛星
- [ ] 宮位視覺化

### Phase 4: AI 整合
- [ ] OpenAI / Gemini API
- [ ] 智能解析
- [ ] 多語系支援

---

**維護者**: Claude Code
**專案開始**: 2025-11-29
**最後更新**: 2025-11-29
